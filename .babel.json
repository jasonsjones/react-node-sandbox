{
  "{\"filename\":\"/home/blacktab/src/server.js\",\"env\":{},\"retainLines\":true,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceMaps\":true,\"sourceRoot\":\"/home/blacktab/src\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.25.0": {
    "metadata": {
      "usedHelpers": [
        "interopRequireDefault"
      ],
      "marked": [],
      "modules": {
        "imports": [
          {
            "source": "express",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "express"
              }
            ]
          },
          {
            "source": "body-parser",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "bodyParser"
              }
            ]
          },
          {
            "source": "mongoose",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "mongoose"
              }
            ]
          },
          {
            "source": "multer",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "multer"
              }
            ]
          },
          {
            "source": "fs",
            "imported": [
              "default"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "default",
                "local": "fs"
              }
            ]
          }
        ],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/home/blacktab/src/server.js",
      "filenameRelative": "/home/blacktab/src/server.js",
      "env": {},
      "retainLines": true,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "server.js",
      "sourceFileName": "server.js",
      "sourceRoot": "/home/blacktab/src",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/home/blacktab/src",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "server"
    },
    "ignored": false,
    "code": "'use strict';\nvar _express = require('express');var _express2 = _interopRequireDefault(_express);\nvar _bodyParser = require('body-parser');var _bodyParser2 = _interopRequireDefault(_bodyParser);\nvar _mongoose = require('mongoose');var _mongoose2 = _interopRequireDefault(_mongoose);\nvar _multer = require('multer');var _multer2 = _interopRequireDefault(_multer);\nvar _fs = require('fs');var _fs2 = _interopRequireDefault(_fs);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}\n\nvar app = (0, _express2.default)();\nvar Schema = _mongoose2.default.Schema;\n\napp.use(_bodyParser2.default.json());\napp.use(_bodyParser2.default.urlencoded({ extended: false }));\n\n_mongoose2.default.connect('mongodb://mongo/testdb');\nvar db = _mongoose2.default.connection;\ndb.once('open', function () {\n    console.log('Connected to mongo');\n});\ndb.on('error', console.error.bind(console, 'connection error'));\ndb.on('disconnected', function () {\n    console.log('Mongoose disconnected');\n});\nprocess.on('SIGINT', function () {\n    db.close(function () {\n        console.log('Mongoose default connection closed via app termination');\n        process.exit(0);\n    });\n});\n\nvar avatarSchema = new Schema({\n    fileName: String,\n    contentType: String,\n    data: Buffer,\n    defaultImg: Boolean });\n\n\nvar Avatar = _mongoose2.default.model('Avatar', avatarSchema);\n\nvar userSchema = new Schema({ name: String,\n    email: String,\n    avatar: { type: Schema.Types.ObjectId, ref: 'Avatar' },\n    avatarUrl: String });\n\n\nvar User = _mongoose2.default.model('User', userSchema);\n\nvar upload = (0, _multer2.default)({ dest: './uploads/' });\n\napp.get('/', function (req, res) {\n    res.json({\n        message: 'Welcome to the API!' });\n\n});\n\napp.get('/api/avatar', function (req, res) {\n    Avatar.find({}, '-data', function (err, avatars) {\n        if (err) {\n            console.log(err);\n            return;\n        }\n        res.json({\n            status: true,\n            data: avatars });\n\n    });\n});\n\n\napp.post('/api/avatar', upload.single('avatar'), function (req, res) {\n    var avatar = new Avatar();\n    avatar.fileName = req.file.originalname;\n    avatar.contentType = req.file.mimetype;\n    avatar.defaultImg = false;\n    avatar.data = _fs2.default.readFileSync(req.file.path);\n    avatar.save(function (err, img) {\n        if (err) {\n            console.log(err);\n            return;\n        }\n        _fs2.default.unlinkSync(req.file.path);\n        res.json({ message: 'avatar uploaded and saved...' });\n\n    });\n});\n\napp.get('/api/avatar/:id', function (req, res) {\n    if (req.params.id === 'default') {\n        Avatar.find({ defaultImg: true }, '-data', function (err, images) {\n            if (err) {\n                console.log(err);\n                return;\n            }\n            res.json({ status: true, data: images });\n        });\n    } else {\n        Avatar.findById(req.params.id, function (err, avatar) {\n            if (err) {\n                console.log(err);\n                return;\n            }\n            res.contentType(avatar.contentType);\n            res.write(avatar.data);\n            res.end();\n        });\n    }\n});\n\napp.get('/api/users', function (req, res) {\n    User.find({}, function (err, users) {\n        if (err) {\n            console.log(err);\n            return;\n        }\n        res.json({ staus: true, data: users });\n    });\n});\n\napp.get('/api/user/:id', function (req, res) {\n    User.findOne({ _id: req.params.id }, function (err, user) {\n        if (err) {\n            console.log(err);\n            return;\n        }\n        res.json({ status: true, data: user });\n    });\n});\n\napp.post('/api/users', function (req, res) {\n    var newUser = new User(req.body);\n    newUser.save(function (err, user) {\n        if (err) {\n            console.log(err);\n            return;\n        }\n        res.json({ message: 'new user saved', data: user });\n    });\n});\n\napp.post('/api/user/:userid/avatar', upload.single('avatar'), function (req, res) {\n    User.findOne({ _id: req.params.userid }, function (err, user) {\n        if (err) {\n            console.log(err);\n            return;\n        }\n        var avatar = new Avatar();\n        avatar.fileName = req.file.originalname;\n        avatar.contentType = req.file.mimetype;\n        avatar.defaultImg = false;\n        avatar.data = _fs2.default.readFileSync(req.file.path);\n        avatar.save(function (err, img) {\n            if (err) {\n                console.log(err);\n                return;\n            }\n            _fs2.default.unlinkSync(req.file.path);\n            user.avatar = img._id;\n            user.avatarUrl = 'http://localhost:3000/api/avatar/' + img._id;\n            user.save(function (err, user) {\n                if (err) {\n                    console.log(err);\n                    return;\n                }\n                res.json({ message: 'avatar uploaded...', data: user });\n            });\n        });\n    });\n});\n\napp.listen(3000, function () {\n    console.log('node server running on port 3000');\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlci5qcyJdLCJuYW1lcyI6WyJhcHAiLCJTY2hlbWEiLCJ1c2UiLCJqc29uIiwidXJsZW5jb2RlZCIsImV4dGVuZGVkIiwiY29ubmVjdCIsImRiIiwiY29ubmVjdGlvbiIsIm9uY2UiLCJjb25zb2xlIiwibG9nIiwib24iLCJlcnJvciIsImJpbmQiLCJwcm9jZXNzIiwiY2xvc2UiLCJleGl0IiwiYXZhdGFyU2NoZW1hIiwiZmlsZU5hbWUiLCJTdHJpbmciLCJjb250ZW50VHlwZSIsImRhdGEiLCJCdWZmZXIiLCJkZWZhdWx0SW1nIiwiQm9vbGVhbiIsIkF2YXRhciIsIm1vZGVsIiwidXNlclNjaGVtYSIsIm5hbWUiLCJlbWFpbCIsImF2YXRhciIsInR5cGUiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwiYXZhdGFyVXJsIiwiVXNlciIsInVwbG9hZCIsImRlc3QiLCJnZXQiLCJyZXEiLCJyZXMiLCJtZXNzYWdlIiwiZmluZCIsImVyciIsImF2YXRhcnMiLCJzdGF0dXMiLCJwb3N0Iiwic2luZ2xlIiwiZmlsZSIsIm9yaWdpbmFsbmFtZSIsIm1pbWV0eXBlIiwicmVhZEZpbGVTeW5jIiwicGF0aCIsInNhdmUiLCJpbWciLCJ1bmxpbmtTeW5jIiwicGFyYW1zIiwiaWQiLCJpbWFnZXMiLCJmaW5kQnlJZCIsIndyaXRlIiwiZW5kIiwidXNlcnMiLCJzdGF1cyIsImZpbmRPbmUiLCJfaWQiLCJ1c2VyIiwibmV3VXNlciIsImJvZHkiLCJ1c2VyaWQiLCJsaXN0ZW4iXSwibWFwcGluZ3MiOiI7QUFDQSxrQztBQUNBLHlDO0FBQ0Esb0M7QUFDQSxnQztBQUNBLHdCOztBQUVBLElBQU1BLE1BQU0sd0JBQVo7QUFDQSxJQUFNQyxTQUFTLG1CQUFTQSxNQUF4Qjs7QUFFQUQsSUFBSUUsR0FBSixDQUFRLHFCQUFXQyxJQUFYLEVBQVI7QUFDQUgsSUFBSUUsR0FBSixDQUFRLHFCQUFXRSxVQUFYLENBQXNCLEVBQUNDLFVBQVUsS0FBWCxFQUF0QixDQUFSOztBQUVB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dkIsR0FBSixFQUFTO0FBQ0xuQyxvQkFBUUMsR0FBUixDQUFZa0MsR0FBWjtBQUNBO0FBQ0g7QUFDRCxZQUFJZCxTQUFTLElBQUlMLE1BQUosRUFBYjtBQUNBSyxlQUFPWixRQUFQLEdBQWtCc0IsSUFBSVMsSUFBSixDQUFTQyxZQUEzQjtBQUNBcEIsZUFBT1YsV0FBUCxHQUFxQm9CLElBQUlTLElBQUosQ0FBU0UsUUFBOUI7QUFDQXJCLGVBQU9QLFVBQVAsR0FBb0IsS0FBcEI7QUFDQU8sZUFBT1QsSUFBUCxHQUFjLGFBQUcrQixZQUFILENBQWdCWixJQUFJUyxJQUFKLENBQVNJLElBQXpCLENBQWQ7QUFDQXZCLGVBQU93QixJQUFQLENBQVksVUFBVVYsR0FBVixFQUFlVyxHQUFmLEVBQW9CO0FBQzVCLGdCQUFJWCxHQUFKLEVBQVM7QUFDTG5DLHdCQUFRQyxHQUFSLENBQVlrQyxHQUFaO0FBQ0E7QUFDSDtBQUNELHlCQUFHWSxVQUFILENBQWNoQixJQUFJUyxJQUFKLENBQVNJLElBQXZCO0FBQ0FjLGlCQUFLckMsTUFBTCxHQUFjeUIsSUFBSVcsR0FBbEI7QUFDQUMsaUJBQUtoQyxTQUFMLHlDQUFxRG9CLElBQUlXLEdBQXpEO0FBQ0FDLGlCQUFLYixJQUFMLENBQVUsVUFBVVYsR0FBVixFQUFldUIsSUFBZixFQUFxQjtBQUMzQixvQkFBSXZCLEdBQUosRUFBUztBQUNMbkMsNEJBQVFDLEdBQVIsQ0FBWWtDLEdBQVo7QUFDQTtBQUNIO0FBQ0RILG9CQUFJdkMsSUFBSixDQUFTLEVBQUN3QyxTQUFTLG9CQUFWLEVBQWdDckIsTUFBTThDLElBQXRDLEVBQVQ7QUFDSCxhQU5EO0FBT0gsU0FmRDtBQWdCSCxLQTFCRDtBQTJCSCxDQTVCRDs7QUE4QkFwRSxJQUFJd0UsTUFBSixDQUFXLElBQVgsRUFBaUIsWUFBTTtBQUNuQjlELFlBQVFDLEdBQVI7QUFDSCxDQUZEIiwiZmlsZSI6InNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS9ibGFja3RhYi9zcmMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IGJvZHlQYXJzZXIgZnJvbSAnYm9keS1wYXJzZXInO1xuaW1wb3J0IG1vbmdvb3NlIGZyb20gJ21vbmdvb3NlJztcbmltcG9ydCBtdWx0ZXIgZnJvbSAnbXVsdGVyJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5cbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbmNvbnN0IFNjaGVtYSA9IG1vbmdvb3NlLlNjaGVtYTtcblxuYXBwLnVzZShib2R5UGFyc2VyLmpzb24oKSk7XG5hcHAudXNlKGJvZHlQYXJzZXIudXJsZW5jb2RlZCh7ZXh0ZW5kZWQ6IGZhbHNlfSkpO1xuXG5tb25nb29zZS5jb25uZWN0KCdtb25nb2RiOi8vbW9uZ28vdGVzdGRiJyk7XG5sZXQgZGIgPSBtb25nb29zZS5jb25uZWN0aW9uO1xuZGIub25jZSgnb3BlbicsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zb2xlLmxvZyhgQ29ubmVjdGVkIHRvIG1vbmdvYCk7XG59KTtcbmRiLm9uKCdlcnJvcicsIGNvbnNvbGUuZXJyb3IuYmluZChjb25zb2xlLCAnY29ubmVjdGlvbiBlcnJvcicpKTtcbmRiLm9uKCdkaXNjb25uZWN0ZWQnLCAoKSA9PiB7XG4gICAgY29uc29sZS5sb2coYE1vbmdvb3NlIGRpc2Nvbm5lY3RlZGApO1xufSk7XG5wcm9jZXNzLm9uKCdTSUdJTlQnLCAoKSA9PiB7XG4gICAgZGIuY2xvc2UoKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnTW9uZ29vc2UgZGVmYXVsdCBjb25uZWN0aW9uIGNsb3NlZCB2aWEgYXBwIHRlcm1pbmF0aW9uJyk7XG4gICAgICAgIHByb2Nlc3MuZXhpdCgwKTtcbiAgICB9KTtcbn0pO1xuXG5jb25zdCBhdmF0YXJTY2hlbWEgPSBuZXcgU2NoZW1hKHtcbiAgICBmaWxlTmFtZTogU3RyaW5nLFxuICAgIGNvbnRlbnRUeXBlOiBTdHJpbmcsXG4gICAgZGF0YTogQnVmZmVyLFxuICAgIGRlZmF1bHRJbWc6IEJvb2xlYW5cbn0pO1xuXG5jb25zdCBBdmF0YXIgPSBtb25nb29zZS5tb2RlbCgnQXZhdGFyJywgYXZhdGFyU2NoZW1hKTtcblxuY29uc3QgdXNlclNjaGVtYSA9IG5ldyBTY2hlbWEoeyBuYW1lOiBTdHJpbmcsXG4gICAgZW1haWw6IFN0cmluZyxcbiAgICBhdmF0YXI6IHt0eXBlOiBTY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogJ0F2YXRhcid9LFxuICAgIGF2YXRhclVybDogU3RyaW5nXG59KTtcblxuY29uc3QgVXNlciA9IG1vbmdvb3NlLm1vZGVsKCdVc2VyJywgdXNlclNjaGVtYSk7XG5cbmNvbnN0IHVwbG9hZCA9IG11bHRlcih7ZGVzdDogJy4vdXBsb2Fkcy8nfSk7XG5cbmFwcC5nZXQoJy8nLCAocmVxLCByZXMpID0+IHtcbiAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdXZWxjb21lIHRvIHRoZSBBUEkhJ1xuICAgIH0pO1xufSk7XG5cbmFwcC5nZXQoJy9hcGkvYXZhdGFyJywgKHJlcSwgcmVzKSA9PiB7XG4gICAgQXZhdGFyLmZpbmQoe30sICctZGF0YScsIGZ1bmN0aW9uIChlcnIsIGF2YXRhcnMpIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXMuanNvbih7XG4gICAgICAgICAgICBzdGF0dXM6IHRydWUsXG4gICAgICAgICAgICBkYXRhOiBhdmF0YXJzXG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG5cblxuYXBwLnBvc3QoJy9hcGkvYXZhdGFyJywgdXBsb2FkLnNpbmdsZSgnYXZhdGFyJyksIChyZXEsIHJlcykgPT4ge1xuICAgIGxldCBhdmF0YXIgPSBuZXcgQXZhdGFyKCk7XG4gICAgYXZhdGFyLmZpbGVOYW1lID0gcmVxLmZpbGUub3JpZ2luYWxuYW1lO1xuICAgIGF2YXRhci5jb250ZW50VHlwZSA9IHJlcS5maWxlLm1pbWV0eXBlO1xuICAgIGF2YXRhci5kZWZhdWx0SW1nID0gZmFsc2U7XG4gICAgYXZhdGFyLmRhdGEgPSBmcy5yZWFkRmlsZVN5bmMocmVxLmZpbGUucGF0aCk7XG4gICAgYXZhdGFyLnNhdmUoZnVuY3Rpb24gKGVyciwgaW1nKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZnMudW5saW5rU3luYyhyZXEuZmlsZS5wYXRoKTtcbiAgICAgICAgcmVzLmpzb24oe21lc3NhZ2U6ICdhdmF0YXIgdXBsb2FkZWQgYW5kIHNhdmVkLi4uJ30pO1xuXG4gICAgfSk7XG59KTtcblxuYXBwLmdldCgnL2FwaS9hdmF0YXIvOmlkJywgKHJlcSwgcmVzKSA9PiB7XG4gICAgaWYgKHJlcS5wYXJhbXMuaWQgPT09ICdkZWZhdWx0Jykge1xuICAgICAgICBBdmF0YXIuZmluZCh7ZGVmYXVsdEltZzogdHJ1ZX0sICctZGF0YScsIGZ1bmN0aW9uIChlcnIsIGltYWdlcykge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzLmpzb24oe3N0YXR1czogdHJ1ZSwgZGF0YTogaW1hZ2VzfSk7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIEF2YXRhci5maW5kQnlJZChyZXEucGFyYW1zLmlkLCBmdW5jdGlvbiAoZXJyLCBhdmF0YXIpIHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcy5jb250ZW50VHlwZShhdmF0YXIuY29udGVudFR5cGUpO1xuICAgICAgICAgICAgcmVzLndyaXRlKGF2YXRhci5kYXRhKTtcbiAgICAgICAgICAgIHJlcy5lbmQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5cbmFwcC5nZXQoJy9hcGkvdXNlcnMnLCAocmVxLCByZXMpID0+IHtcbiAgICBVc2VyLmZpbmQoe30sIGZ1bmN0aW9uIChlcnIsIHVzZXJzKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmVzLmpzb24oe3N0YXVzOiB0cnVlLCBkYXRhOiB1c2Vyc30pO1xuICAgIH0pO1xufSk7XG5cbmFwcC5nZXQoJy9hcGkvdXNlci86aWQnLCAocmVxLCByZXMpID0+IHtcbiAgICBVc2VyLmZpbmRPbmUoe19pZDogcmVxLnBhcmFtcy5pZH0sIGZ1bmN0aW9uIChlcnIsIHVzZXIpIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXMuanNvbih7c3RhdHVzOiB0cnVlLCBkYXRhOiB1c2VyfSk7XG4gICAgfSk7XG59KTtcblxuYXBwLnBvc3QoJy9hcGkvdXNlcnMnLCAocmVxLCByZXMpID0+IHtcbiAgICBsZXQgbmV3VXNlciA9IG5ldyBVc2VyKHJlcS5ib2R5KTtcbiAgICBuZXdVc2VyLnNhdmUoZnVuY3Rpb24gKGVyciwgdXNlcikge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJlcy5qc29uKHttZXNzYWdlOiAnbmV3IHVzZXIgc2F2ZWQnLCBkYXRhOiB1c2VyfSk7XG4gICAgfSk7XG59KTtcblxuYXBwLnBvc3QoJy9hcGkvdXNlci86dXNlcmlkL2F2YXRhcicsIHVwbG9hZC5zaW5nbGUoJ2F2YXRhcicpLCAocmVxLCByZXMpID0+IHtcbiAgICBVc2VyLmZpbmRPbmUoe19pZDogcmVxLnBhcmFtcy51c2VyaWR9LCBmdW5jdGlvbiAoZXJyLCB1c2VyKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGF2YXRhciA9IG5ldyBBdmF0YXIoKTtcbiAgICAgICAgYXZhdGFyLmZpbGVOYW1lID0gcmVxLmZpbGUub3JpZ2luYWxuYW1lO1xuICAgICAgICBhdmF0YXIuY29udGVudFR5cGUgPSByZXEuZmlsZS5taW1ldHlwZTtcbiAgICAgICAgYXZhdGFyLmRlZmF1bHRJbWcgPSBmYWxzZTtcbiAgICAgICAgYXZhdGFyLmRhdGEgPSBmcy5yZWFkRmlsZVN5bmMocmVxLmZpbGUucGF0aCk7XG4gICAgICAgIGF2YXRhci5zYXZlKGZ1bmN0aW9uIChlcnIsIGltZykge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZnMudW5saW5rU3luYyhyZXEuZmlsZS5wYXRoKTtcbiAgICAgICAgICAgIHVzZXIuYXZhdGFyID0gaW1nLl9pZDtcbiAgICAgICAgICAgIHVzZXIuYXZhdGFyVXJsID0gYGh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvYXZhdGFyLyR7aW1nLl9pZH1gO1xuICAgICAgICAgICAgdXNlci5zYXZlKGZ1bmN0aW9uIChlcnIsIHVzZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzLmpzb24oe21lc3NhZ2U6ICdhdmF0YXIgdXBsb2FkZWQuLi4nLCBkYXRhOiB1c2VyfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcblxuYXBwLmxpc3RlbigzMDAwLCAoKSA9PiB7XG4gICAgY29uc29sZS5sb2coYG5vZGUgc2VydmVyIHJ1bm5pbmcgb24gcG9ydCAzMDAwYCk7XG59KTsiXX0=",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "server.js"
      ],
      "names": [
        "app",
        "Schema",
        "use",
        "json",
        "urlencoded",
        "extended",
        "connect",
        "db",
        "connection",
        "once",
        "console",
        "log",
        "on",
        "error",
        "bind",
        "process",
        "close",
        "exit",
        "avatarSchema",
        "fileName",
        "String",
        "contentType",
        "data",
        "Buffer",
        "defaultImg",
        "Boolean",
        "Avatar",
        "model",
        "userSchema",
        "name",
        "email",
        "avatar",
        "type",
        "Types",
        "ObjectId",
        "ref",
        "avatarUrl",
        "User",
        "upload",
        "dest",
        "get",
        "req",
        "res",
        "message",
        "find",
        "err",
        "avatars",
        "status",
        "post",
        "single",
        "file",
        "originalname",
        "mimetype",
        "readFileSync",
        "path",
        "save",
        "img",
        "unlinkSync",
        "params",
        "id",
        "images",
        "findById",
        "write",
        "end",
        "users",
        "staus",
        "findOne",
        "_id",
        "user",
        "newUser",
        "body",
        "userid",
        "listen"
      ],
      "mappings": "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",
      "file": "server.js",
      "sourceRoot": "/home/blacktab/src",
      "sourcesContent": [
        "\nimport express from 'express';\nimport bodyParser from 'body-parser';\nimport mongoose from 'mongoose';\nimport multer from 'multer';\nimport fs from 'fs';\n\nconst app = express();\nconst Schema = mongoose.Schema;\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({extended: false}));\n\nmongoose.connect('mongodb://mongo/testdb');\nlet db = mongoose.connection;\ndb.once('open', function () {\n    console.log(`Connected to mongo`);\n});\ndb.on('error', console.error.bind(console, 'connection error'));\ndb.on('disconnected', () => {\n    console.log(`Mongoose disconnected`);\n});\nprocess.on('SIGINT', () => {\n    db.close(() => {\n        console.log('Mongoose default connection closed via app termination');\n        process.exit(0);\n    });\n});\n\nconst avatarSchema = new Schema({\n    fileName: String,\n    contentType: String,\n    data: Buffer,\n    defaultImg: Boolean\n});\n\nconst Avatar = mongoose.model('Avatar', avatarSchema);\n\nconst userSchema = new Schema({ name: String,\n    email: String,\n    avatar: {type: Schema.Types.ObjectId, ref: 'Avatar'},\n    avatarUrl: String\n});\n\nconst User = mongoose.model('User', userSchema);\n\nconst upload = multer({dest: './uploads/'});\n\napp.get('/', (req, res) => {\n    res.json({\n        message: 'Welcome to the API!'\n    });\n});\n\napp.get('/api/avatar', (req, res) => {\n    Avatar.find({}, '-data', function (err, avatars) {\n        if (err) {\n            console.log(err);\n            return;\n        }\n        res.json({\n            status: true,\n            data: avatars\n        });\n    });\n});\n\n\napp.post('/api/avatar', upload.single('avatar'), (req, res) => {\n    let avatar = new Avatar();\n    avatar.fileName = req.file.originalname;\n    avatar.contentType = req.file.mimetype;\n    avatar.defaultImg = false;\n    avatar.data = fs.readFileSync(req.file.path);\n    avatar.save(function (err, img) {\n        if (err) {\n            console.log(err);\n            return;\n        }\n        fs.unlinkSync(req.file.path);\n        res.json({message: 'avatar uploaded and saved...'});\n\n    });\n});\n\napp.get('/api/avatar/:id', (req, res) => {\n    if (req.params.id === 'default') {\n        Avatar.find({defaultImg: true}, '-data', function (err, images) {\n            if (err) {\n                console.log(err);\n                return;\n            }\n            res.json({status: true, data: images});\n        });\n    } else {\n        Avatar.findById(req.params.id, function (err, avatar) {\n            if (err) {\n                console.log(err);\n                return;\n            }\n            res.contentType(avatar.contentType);\n            res.write(avatar.data);\n            res.end();\n        });\n    }\n});\n\napp.get('/api/users', (req, res) => {\n    User.find({}, function (err, users) {\n        if (err) {\n            console.log(err);\n            return;\n        }\n        res.json({staus: true, data: users});\n    });\n});\n\napp.get('/api/user/:id', (req, res) => {\n    User.findOne({_id: req.params.id}, function (err, user) {\n        if (err) {\n            console.log(err);\n            return;\n        }\n        res.json({status: true, data: user});\n    });\n});\n\napp.post('/api/users', (req, res) => {\n    let newUser = new User(req.body);\n    newUser.save(function (err, user) {\n        if (err) {\n            console.log(err);\n            return;\n        }\n        res.json({message: 'new user saved', data: user});\n    });\n});\n\napp.post('/api/user/:userid/avatar', upload.single('avatar'), (req, res) => {\n    User.findOne({_id: req.params.userid}, function (err, user) {\n        if (err) {\n            console.log(err);\n            return;\n        }\n        let avatar = new Avatar();\n        avatar.fileName = req.file.originalname;\n        avatar.contentType = req.file.mimetype;\n        avatar.defaultImg = false;\n        avatar.data = fs.readFileSync(req.file.path);\n        avatar.save(function (err, img) {\n            if (err) {\n                console.log(err);\n                return;\n            }\n            fs.unlinkSync(req.file.path);\n            user.avatar = img._id;\n            user.avatarUrl = `http://localhost:3000/api/avatar/${img._id}`;\n            user.save(function (err, user) {\n                if (err) {\n                    console.log(err);\n                    return;\n                }\n                res.json({message: 'avatar uploaded...', data: user});\n            });\n        });\n    });\n});\n\napp.listen(3000, () => {\n    console.log(`node server running on port 3000`);\n});"
      ]
    },
    "mtime": 1500740544000
  }
}